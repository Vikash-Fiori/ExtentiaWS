sap.ui.define(["sap/ui/core/Control","sap/m/Select","sap/ui/core/Item","sap/m/Switch","sap/m/Toolbar","../libs/instascan.min","../libs/adapter"],function(e,n,t,a,i,r,s){"use strict";return e.extend("be.wl.ScannerAppLibrary.controls.QRScanner",{metadata:{properties:{value:"string"},events:{QRCodeScanned:{parameters:{value:{type:"string"}}}},aggregations:{_toolbar:{type:"sap.m.Toolbar",multiple:false,visibility:"hidden"}}},init:function(){this._cameraSelection=new n({change:this.onChangeCamera.bind(this)});this._mirrorSwitch=new a({state:false,change:this.onChangeMirror.bind(this)});this.setAggregation("_toolbar",new i({content:[this._cameraSelection,this._mirrorSwitch]}))},onAfterRendering:function(e){this.scanner=new Instascan.Scanner({video:this.getDomRef().lastElementChild,mirror:false});this.scanner.addListener("scan",function(e){this.onQRCodeScanned(e)}.bind(this));Instascan.Camera.getCameras().then(function(e){this.cameras=e;e.forEach(function(e,n){this._cameraSelection.addItem(new t({key:n,text:e.name}))}.bind(this));if(e.length>0){this.scanner.start(e[0])}else{console.error("No cameras found.")}}.bind(this)).catch(function(e){console.error(e)})},onQRCodeScanned:function(e){this.setProperty("value",e,true);this.fireQRCodeScanned({value:e})},onChangeCamera:function(e){this.scanner.start(this.cameras[e.getParameter("selectedItem").getKey()])},onChangeMirror:function(e){this.scanner.mirror=e.getParameter("state")}})});