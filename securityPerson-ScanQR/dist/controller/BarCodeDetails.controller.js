sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/model/Sorter","sap/ui/Device","sap/ui/core/routing/History","sap/m/ColumnListItem","sap/m/Input","../utils/formatter","jquery.sap.global"],function(e,t,i,o,n,s,a,r,l,d,c,u){"use strict";return e.extend("com.agel.mmts.securityPerson-ScanQR.controller.BarCodeDetails",{formatter:c,onInit:function(){u.sap.addUrlWhitelist("blob");var e=new t({busy:true,delay:0});this.setModel(e,"objectViewModel");var i=new t({EnterVehicleNo:null,ReEnterVehicleNo:null,wantChange:false});this.setModel(i,"oViewHandlingModel");this.oRouter=this.getRouter();this.oRouter.getRoute("BarCodeDetailsPage").attachPatternMatched(this._onObjectMatched,this)},_onObjectMatched:function(e){var t=e.getParameters().arguments.QRCode;this._bindView("/enterQRNumber("+t+")")},_bindView:function(e){var t=this.getViewModel("objectViewModel");this.getView().bindElement({path:e,parameters:{$expand:{insp_call:{$select:["inspection_call_id"]},packing_list:{$expand:{insepected_parent_line_items:{$select:["packing_list_ID","po_number","material_code","name","description"]},qr_code:{},attachments:{},gate:{$select:["entry_id"]}},$select:["vehicle_no","qr_code_ID","name"]},purchase_order:{$expand:{vendor:{$expand:{address:{$select:["street","city","state","country"]}},$select:["name"]}},$select:["asn_number","po_number","asn_creation_date","vendor_ID"]}}},events:{dataRequested:function(){t.setProperty("/busy",true)},dataReceived:function(){t.setProperty("/busy",false)}}})},onChangeVehicleNumberPress:function(){var e=this.getViewModel("oViewHandlingModel").getProperty("/wantChange");if(e){this.getViewModel("oViewHandlingModel").setProperty("/wantChange",false)}else{this.getViewModel("oViewHandlingModel").setProperty("/wantChange",true)}},onPressApproveQRCode:function(){this.byId("idHboxReEnterVehicleNob").setVisible(false)},onPressRejectQRCode:function(){this.byId("idHboxReEnterVehicleNob").setVisible(true)},onPressSubmitQRCode:function(e){var t=this,i=this.getView().getBindingContext().getObject(),o=e.getSource().getObjectBinding();o.getParameterContext().setProperty("packingListId",i.packing_list.ID);o.getParameterContext().setProperty("vehicleNumber",this.getViewModel("oViewHandlingModel").getProperty("/ReEnterVehicleNo"));o.execute().then(function(){sap.m.MessageToast.show("Submited Successfully");t.getView().getModel().refresh();t.getViewModel("oViewHandlingModel").setProperty("/wantChange",false)},function(e){sap.m.MessageBox.alert(e.message,{title:"Error"})})},onViewQRCodePress:function(e){if(!this._oCreateParentItemDialog){this._oCreateDialog=sap.ui.xmlfragment("com.agel.mmts.securityPerson-ScanQR.view.fragments.ViewQR",this);this.getView().addDependent(this._oCreateDialog)}this._oCreateDialog.open()},closeDialog:function(){this._oCreateDialog.close()}})});