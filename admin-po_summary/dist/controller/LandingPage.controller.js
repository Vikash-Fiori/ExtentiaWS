sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/model/Sorter","sap/ui/Device","sap/ui/core/ValueState"],function(e,t,i,a,n,r,s,o){"use strict";return e.extend("com.agel.mmts.adminposummary.controller.LandingPage",{onInit:function(){this.oRouter=this.getRouter();this.oRouter.getRoute("RouteLandingPage").attachPatternMatched(this._onObjectMatched,this);var e=new t({busy:false,delay:0});this.setModel(e,"objectViewModel");var i=new t({openCount:null,confirmCount:null,dispatchCount:null});this.setModel(i,"oIconTabCountModel");this._aTableSearchState=[];this._mViewSettingsDialogs={};this.initializeFilterBar()},_onObjectMatched:function(e){var t=this.getOwnerComponent().getComponentData().startupParameters;this.type=t.Kind[0];this.byId("idIconTabBar").setSelectedKey(this.type);this.onIconTabBarChanged(this.type)},onPurchaseOrderTableUpdateFinished:function(e){this.setIconTabCount(e,e.getParameter("total"),"/openCount")},setIconTabCount:function(e,t,i){if(e.getSource().getBinding("items").isLengthFinal()){this.getView().getModel("oIconTabCountModel").setProperty(i,t)}},onPurchaseOrderPress:function(e){this._showObject(e.getSource())},_showObject:function(e){var t=this;var i=e.getBindingContext().sPath;t.getRouter().navTo("RoutePODetailPage",{POId:i.slice("/PurchaseOrderSet".length)})},onDateRangeSelectionChange:function(e){var t=e.getParameter("from"),i=e.getParameter("to"),a=e.getParameter("valid"),n=e.getSource(),r=this.byId("TextEvent");if(a){n.setValueState(o.None)}else{n.setValueState(o.Error)}this.oFilterBar.fireFilterChange(e)},onSearch:function(e){var t=this.byId("idNameInput").getValue();var n=this.byId("dateRangeSelectionId");var r=this.byId("dateRangeSelectionId").getValue();var s=this.byId("idPlantCode").getValue();var o=this.byId("idMaterialCode").getValue();var l=this.byId("idCompanyCode").getValue();var d=[];var h=[];var u=this.byId("filterbar").getBasicSearchValue();if(u){d.push(new i("PONumber",a.Contains,u));d.push(new i("Buyer/CompanyCode",a.EQ,u));d.push(new i("ParentLineItems/MaterialCode",a.EQ,u));d.push(new i("PlantCode",a.EQ,u));d.push(new i("ParentLineItems/Name",a.Contains,u));h.push(new i(d,false))}if(t!=""){h.push(new i("PONumber",a.EQ,t))}if(r!=""){var g=new Date(n.getFrom());var c=new Date(n.getTo());h.push(new i("POReleaseDate",a.BT,g.toISOString(),c.toISOString()))}if(l!=""){h.push(new i("Buyer/CompanyCode",a.EQ,l))}if(o!=""){h.push(new i("ParentLineItems/MaterialCode",a.EQ,o))}if(s!=""){h.push(new i("PlantCode",a.EQ,s))}var m=this.getView().byId("idPurchaseOrdersTable").getTable().getBinding("items");var p=this.getView().byId("idConfirmPOTable").getTable().getBinding("items");var b=this.getView().byId("idDispatchedPOTable").getTable().getBinding("items");if(h.length==0){h.push(new i("PONumber",a.NE,""));m.filter(new i(h,true));p.filter(new i(h,true));b.filter(new i(h,true))}if(h.length>0){m.filter(new i(h,true));p.filter(new i(h,true));b.filter(new i(h,true))}},onResetFilters:function(){this.oFilterBar._oBasicSearchField.setValue("");this.byId("idNameInput").setValue("");this.byId("idMaterialCode").setValue("");this.byId("dateRangeSelectionId").setValue("");this.byId("idPlantCode").setValue("");this.byId("idCompanyCode").setValue("");var e=this.getView().byId("idPurchaseOrdersTable").getTable().getBinding("items");var t=this.getView().byId("idConfirmPOTable").getTable().getBinding("items");var i=this.getView().byId("idDispatchedPOTable").getTable().getBinding("items");e.filter([]);t.filter([]);i.filter([]);this.oFilterBar.fireFilterChange()},onFilterChange:function(e){this.oFilterBar.fireFilterChange(e)},onViewLineItemsPress:function(e){var t=e.getSource().getParent().getBindingContextPath();var i="PO - "+e.getSource().getBindingContext().getObject().PONumber;var a={};a.controller=this;a.view=this.getView();a.sParentItemPath=t;a.title=i;if(!this.pDialog){this.pDialog=n.load({id:a.view.getId(),name:"com.agel.mmts.adminposummary.view.fragments.ViewLineItemsDialog",controller:a.controller}).then(function(e){a.view.addDependent(e);if(s.system.desktop){e.addStyleClass("sapUiSizeCompact")}e.bindElement({path:a.sParentItemPath,parameters:{expand:"ParentLineItems"}});e.setTitle(a.title);return e})}this.pDialog.then(function(e){a.view.addDependent(e);e.bindElement({path:a.sParentItemPath,parameters:{expand:"ParentLineItems"}});e.setTitle(a.title);e.open()})},onViewChildDialogClose:function(e){this.pDialog.then(function(e){e.close()})}})});