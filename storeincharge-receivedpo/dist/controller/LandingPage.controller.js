sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/Fragment","sap/ui/model/Sorter","sap/ui/Device","sap/ui/core/ValueState","../utils/formatter"],function(e,t,i,a,n,r,s,o,l){"use strict";return e.extend("com.agel.mmts.storeinchargereceivedpo.controller.LandingPage",{formatter:l,onInit:function(){var e=new t({busy:false,delay:0});this.setModel(e,"objectViewModel");var i=new t({dispatchCount:null});this.setModel(i,"oIconTabCountModel");this._aTableSearchState=[];this._mViewSettingsDialogs={};this.initializeFilterBar()},onbeforeRebindDispatchPoTable:function(e){var t=e.getParameter("bindingParams");t.filters.push(new i("POStatusAsPerPackingList",sap.ui.model.FilterOperator.EQ,3));t.filters.push(new i("POStatusAsPerPackingList",sap.ui.model.FilterOperator.EQ,4))},onReceivedPOTableUpdateFinished:function(e){this.setIconTabCount(e,e.getParameter("total"),"/dispatchCount")},setIconTabCount:function(e,t,i){if(e.getSource().getBinding("items").isLengthFinal()){this.getView().getModel("oIconTabCountModel").setProperty(i,t)}},onPurchaseOrderPress:function(e){this._showObject(e.getSource())},_showObject:function(e){var t=this;var i=e.getBindingContext().sPath;if(sap.ushell&&sap.ushell.Container&&sap.ushell.Container.getService){var a=sap.ushell.Container.getService("CrossApplicationNavigation");var n=a&&a.hrefForExternal({target:{semanticObject:"TotalDetails",action:"manage"},params:{ID:i.slice("/PurchaseOrderSet".length),Type:"RECEIVED"}})||"";a.toExternal({target:{shellHash:n}})}else{jQuery.sap.log.info("Navigating as Standalone Application")}},handleToAllVendorsBreadcrumPress:function(e){this.getRouter().navTo("RouteLandingPage")},onDateRangeSelectionChange:function(e){var t=e.getParameter("from"),i=e.getParameter("to"),a=e.getParameter("valid"),n=e.getSource(),r=this.byId("TextEvent");if(a){n.setValueState(o.None)}else{n.setValueState(o.Error)}this.oFilterBar.fireFilterChange(e)},onSearch:function(e){var t=this.byId("idNameInput").getValue();var n=this.byId("dateRangeSelectionId");var r=this.byId("dateRangeSelectionId").getValue();var s=this.byId("idCompanyCode").getValue();var o=[];var l=[];var d=this.byId("filterbar").getBasicSearchValue();if(d){o.push(new i("PONumber",a.Contains,d));o.push(new i("Buyer/CompanyCode",a.EQ,d));o.push(new i("ParentLineItems/Name",a.Contains,d));l.push(new i(o,false))}if(t!=""){l.push(new i("PONumber",a.EQ,t))}if(r!=""){var u=new Date(n.getFrom());var g=new Date(n.getTo());l.push(new i("POReleaseDate",a.BT,u.toISOString(),g.toISOString()))}if(s!=""){l.push(new i("Buyer/CompanyCode",a.EQ,s))}var h=this.getView().byId("idReceivedPOTable").getTable().getBinding("items");if(l.length==0){l.push(new i("PONumber",a.NE,""));h.filter(new i(l,true))}if(l.length>0){h.filter(new i(l,true))}},onResetFilters:function(){this.oFilterBar._oBasicSearchField.setValue("");this.byId("idNameInput").setValue("");this.byId("dateRangeSelectionId").setValue("");this.byId("idCompanyCode").setValue("");var e=this.getView().byId("idReceivedPOTable").getTable().getBinding("items");e.filter([]);this.oFilterBar.fireFilterChange()},onFilterChange:function(e){this.oFilterBar.fireFilterChange(e)},onViewLineItemsPress:function(e){var t=e.getSource().getParent().getBindingContextPath();var i="PO - "+e.getSource().getBindingContext().getObject().PONumber;var a={};a.controller=this;a.view=this.getView();a.sParentItemPath=t;a.title=i;if(!this.pDialog){this.pDialog=n.load({id:a.view.getId(),name:"com.agel.mmts.storeinchargereceivedpo.view.fragments.landingPage.ViewLineItemsDialog",controller:a.controller}).then(function(e){a.view.addDependent(e);if(s.system.desktop){e.addStyleClass("sapUiSizeCompact")}e.bindElement({path:a.sParentItemPath,parameters:{expand:"ParentLineItems"}});e.setTitle(a.title);return e})}this.pDialog.then(function(e){a.view.addDependent(e);e.bindElement({path:a.sParentItemPath,parameters:{expand:"ParentLineItems"}});e.setTitle(a.title);e.open()})},onViewChildDialogClose:function(e){this.pDialog.then(function(e){e.close()})}})});